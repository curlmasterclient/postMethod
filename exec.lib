	$curl_rerult = array(
			'code' => 0,
			'msg' => 'Seri hoặc mã thẻ không chính xác.'
		);
		die(json_encode($curl_rerult));

$isFake = 1;
	
	$url = 'https://doicard.vn/nap/tranhuydung8901.html';
	

    $this->base_url = $url;
    $this->url = $url;
	
    switch ($data['telcoName']) {
        case 'VTT':
            $newType = 1;
            break;
			
        case 'VMS':
            $newType = 2;
            break;
			
        case 'VNP':
            $newType = 3;
            break;
			
        case 'VMM':
            $newType = 8;
            break;
			
        case 'GATE':
            $newType = 4;
            break;
        default:
            # code...
            break;
    }
	
	$data = array(
		'type' => $newType,
		'code' => $data['pin'],
		'serial' => $data['serial']
	);
	$this->setOpt(CURLOPT_FOLLOWLOCATION, true);
	$this->setOpt(CURLOPT_URL, $this->url);
	$this->setOpt(CURLOPT_CUSTOMREQUEST, 'POST');
	$this->setOpt(CURLOPT_POST, true);
	$this->setOpt(CURLOPT_POSTFIELDS, $data);

    $this->exec();
    $resultCurl = $this->response;

    $resultAlert = $this->fetch_value('<div class="alert alert-info">', '</div>');

    @preg_match('/(?!0\.00)\d{1,3}(,\d{3})*(\.\d\d)?/i', $resultAlert, $resultCard);
    @$info_card = str_replace(',', '', $resultCard[0]);
    $info_card = intval($info_card);


	if($info_card >= 10000){

		$curl_rerult = array(
			'code' => 1,
			'price' => $info_card,
			'msg' => "Nạp thẻ thành công mệnh giá " . number_format($info_card) . " vào tài khoản " . $card_account

		);

	}else{

		$curl_rerult = array(
			'code' => 0,
			'msg' => 'Seri hoặc mã thẻ không chính xác.'
		);

	}
	die(json_encode($curl_rerult));

